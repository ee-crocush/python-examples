# Celery ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?

Celery ‚Äî —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∞—Å–∫-–º–µ–Ω–µ–¥–∂–µ—Ä (–æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á) –¥–ª—è Python. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—è –Ω–∞–≥—Ä—É–∑–∫—É –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏.

üìå –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è: —Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—à—å –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å, –∞ –≤–æ—Ä–∫–µ—Ä (worker) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ—ë –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## üî• –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Celery?

- –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ ‚Äì –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫–∞ email, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).
- –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á ‚Äì –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏.
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á (Cron-like) ‚Äì –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–∏—Å—Ç–∫–∞ –ë–î –∫–∞–∂–¥—É—é –Ω–æ—á—å).
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Äì –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É.
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å ‚Äì —Ä–∞–∑–≥—Ä—É–∂–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## ‚ö° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Celery?

1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (producer) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –±—Ä–æ–∫–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Redis –∏–ª–∏ RabbitMQ).
2. –ë—Ä–æ–∫–µ—Ä —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å.
3. –í–æ—Ä–∫–µ—Ä—ã (worker) –ø–æ–ª—É—á–∞—é—Ç –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –µ—ë.
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ backend-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Redis, PostgreSQL, MongoDB).

### –ù–µ–º–Ω–æ–≥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏

#### üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Celery

```bash
pip install celery
```

#### üöÄ –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä:

```python
from celery import Celery

# –°–æ–∑–¥–∞—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Celery

app = Celery("tasks", broker="redis://localhost:6379/0")


@app.task
def add(x, y):
    return x + y
```

#### üìå –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ (—á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏):

```bash
celery -A tasks worker --loglevel=info
```

#### üìå –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å:

```python
result = add.delay(4, 6)
print(result.get())  # –í—ã–≤–µ–¥–µ—Ç 10 (–ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
```

#### üîÑ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (Celery + Beat)

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Celery Beat –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–∞–Ω–∞–ª–æ–≥ cron):

```bash
pip install celery[redis] celery-beat
```

–ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–π —Ä–∞–∑ –≤ 10 —Å–µ–∫—É–Ω–¥:

```python
from celery.schedules import crontab

app.conf.beat_schedule = {
    "run-every-10-seconds": {
        "task": "tasks.add",
        "schedule": 10.0,
        "args": (2, 2),
    },
}
```

–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:

```bash
celery -A tasks beat --loglevel=info
```

### üõ† –ö–∞–∫ Celery —Å–≤—è–∑–∞–Ω —Å FastAPI?

Celery –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –≤ FastAPI. –ù–∞–ø—Ä–∏–º–µ—Ä:

- –û—Ç–ø—Ä–∞–≤–∫–∞ email –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤.
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ –≤–∏–¥–µ–æ.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API –±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

#### –ü—Ä–∏–º–µ—Ä FastAPI + Celery:

```python
from fastapi import FastAPI
from celery import Celery

app = FastAPI()
celery = Celery("tasks", broker="redis://localhost:6379/0")


@app.post("/start-task/")
def start_task():
    task = celery.send_task("tasks.add", args=[2, 3])
    return {"task_id": task.id}
```

## –ò—Ç–æ–≥

### üî• –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Celery?

- –ï—Å–ª–∏ —É —Ç–µ–±—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º, —Å–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è).
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏).
- –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (–∑–∞–º–µ–Ω–∞ cron).

### ‚ùå –ö–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–µ–Ω Celery?

- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (–º–µ–Ω—å—à–µ 100 –º—Å).
- –ï—Å–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ asyncio –∑–∞–¥–∞—á–∏ (–≤ FastAPI).